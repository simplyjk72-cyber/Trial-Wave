<!DOCTYPE html>
<html>
<head>
<title>Real ZigZag Wave</title>
<style>
body { margin:0; overflow:hidden; background:black; }
canvas { display:block; }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

let gameState = "playing";
let score = 0;
let highScore = localStorage.getItem("waveHighScore") || 0;
let lastScoreTime = Date.now();

let baseSpeed = 8; // harder
let speedMultiplier = 1;

let player = {
  x: 200,
  y: canvas.height/2,
  size: 14,
  hitbox: 10
};

let holding = false;

let segments = [];
let segmentWidth = 80; // smaller = harder
let gapSize = 140;     // tighter gap
let spawnX = canvas.width;
let lastCenterY = canvas.height/2;

// ------- TRIANGLE COLLISION --------
function triangleCollision(px, py, size, t){
  let cx = px + size/2;
  let cy = py + size/2;

  let area = Math.abs((t.x2-t.x1)*(t.y3-t.y1)-(t.x3-t.x1)*(t.y2-t.y1));
  let a1 = Math.abs((t.x1-cx)*(t.y2-cy)-(t.x2-cx)*(t.y1-cy));
  let a2 = Math.abs((t.x2-cx)*(t.y3-cy)-(t.x3-cx)*(t.y2-cy));
  let a3 = Math.abs((t.x3-cx)*(t.y1-cy)-(t.x1-cx)*(t.y3-cy));

  return Math.abs(area-(a1+a2+a3)) < 0.5;
}

// ------- SPAWN TRUE ðŸ”ºðŸ”» CONNECTED --------
function spawnSegment(){

  // random vertical movement
  let change = (Math.random()*120 - 60);
  let centerY = lastCenterY + change;

  // clamp inside screen
  centerY = Math.max(150, Math.min(canvas.height-150, centerY));

  let topY = centerY - gapSize/2;
  let bottomY = centerY + gapSize/2;

  segments.push({
    x: spawnX,
    topY: topY,
    bottomY: bottomY,
    prevTopY: lastCenterY - gapSize/2,
    prevBottomY: lastCenterY + gapSize/2
  });

  lastCenterY = centerY;
  spawnX += segmentWidth;
}

for(let i=0;i<20;i++) spawnSegment();

// -------- INPUT --------
function startHold(){ if(gameState==="playing") holding=true; }
function stopHold(){ holding=false; }

document.addEventListener("keydown", e=>{
  if(["Space","KeyW","ArrowUp"].includes(e.code)) startHold();
  if(e.key==="r") location.reload();
});
document.addEventListener("keyup", e=>{
  if(["Space","KeyW","ArrowUp"].includes(e.code)) stopHold();
});
document.addEventListener("mousedown", e=>{ if(e.button===0) startHold(); });
document.addEventListener("mouseup", e=>{ if(e.button===0) stopHold(); });

// -------- UPDATE --------
function update(){

  ctx.fillStyle="black";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  if(gameState==="dead"){
    ctx.fillStyle="white";
    ctx.font="40px Arial";
    ctx.fillText("YOU DIED - PRESS R", canvas.width/2-180, canvas.height/2);
    requestAnimationFrame(update);
    return;
  }

  // score every 0.5s
  let now = Date.now();
  if(now-lastScoreTime >= 500){
    score++;
    lastScoreTime = now;

    // harder over time
    if(score % 15 === 0 && gapSize > 100){
      gapSize -= 8;
    }
    if(score % 25 === 0){
      speedMultiplier += 0.15;
    }
  }

  if(score > highScore){
    highScore = score;
    localStorage.setItem("waveHighScore", highScore);
  }

  let speed = baseSpeed * speedMultiplier;

  // wave movement (45Â° feel)
  let waveSpeed = 6 * speedMultiplier;
  if(holding) player.y -= waveSpeed;
  else player.y += waveSpeed;

  ctx.fillStyle="cyan";
  ctx.fillRect(player.x, player.y, player.size, player.size);

  for(let s of segments){

    s.x -= speed;

    // ----- DRAW CONNECTED TOP SLOPE (ðŸ”º /) -----
    let topTriangle = {
      x1: s.x,
      y1: s.prevTopY,
      x2: s.x + segmentWidth,
      y2: s.topY,
      x3: s.x,
      y3: 0
    };

    ctx.fillStyle="orange";
    ctx.beginPath();
    ctx.moveTo(topTriangle.x1, topTriangle.y1);
    ctx.lineTo(topTriangle.x2, topTriangle.y2);
    ctx.lineTo(topTriangle.x3, topTriangle.y3);
    ctx.closePath();
    ctx.fill();

    // ----- DRAW CONNECTED BOTTOM SLOPE (ðŸ”» \) -----
    let bottomTriangle = {
      x1: s.x,
      y1: s.prevBottomY,
      x2: s.x + segmentWidth,
      y2: s.bottomY,
      x3: s.x,
      y3: canvas.height
    };

    ctx.beginPath();
    ctx.moveTo(bottomTriangle.x1, bottomTriangle.y1);
    ctx.lineTo(bottomTriangle.x2, bottomTriangle.y2);
    ctx.lineTo(bottomTriangle.x3, bottomTriangle.y3);
    ctx.closePath();
    ctx.fill();

    if(triangleCollision(player.x+2, player.y+2, player.hitbox, topTriangle) ||
       triangleCollision(player.x+2, player.y+2, player.hitbox, bottomTriangle))
       gameState="dead";

    if(s.x < -segmentWidth){
      segments.shift();
      spawnSegment();
    }
  }

  ctx.fillStyle="white";
  ctx.font="20px Arial";
  ctx.fillText("Score: "+score, 20, 40);
  ctx.fillText("Highscore: "+highScore, 150, 40);

  requestAnimationFrame(update);
}

update();
</script>
</body>
</html>


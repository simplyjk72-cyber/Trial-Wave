<!DOCTYPE html>
<html>
<head>
<title>Forced Insane Mini Wave</title>
<style>
body { margin:0; overflow:hidden; background:black; }
canvas { display:block; }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

let gameState = "playing";
let score = 0;

let baseSpeed = 14;         // MUCH FASTER
let player = {
  x: 180,
  y: canvas.height/2,
  size: 7,                 // smaller mini
  hitbox: 5
};

let holding = false;

let segments = [];
let segmentWidth = 45;      // short = rapid turns
let gapSize = 70;           // tight start
let spawnX = canvas.width;
let lastCenterY = canvas.height/2;
let direction = 1;          // forces alternating pattern

// ---- COLLISION ----
function lineCollision(px, py, size, x1, y1, x2, y2){
  let cx = px + size/2;
  let cy = py + size/2;

  let dx = x2 - x1;
  let dy = y2 - y1;
  let length = Math.sqrt(dx*dx + dy*dy);

  let dot = ((cx-x1)*dx + (cy-y1)*dy) / (length*length);
  dot = Math.max(0, Math.min(1, dot));

  let closestX = x1 + dot*dx;
  let closestY = y1 + dot*dy;

  let distX = cx - closestX;
  let distY = cy - closestY;
  let distance = Math.sqrt(distX*distX + distY*distY);

  return distance < player.hitbox/2;
}

// ---- FORCED ALTERNATING SPAWN ----
function spawnSegment(){

  // FORCE big vertical move each time
  let shift = direction * 120;

  let centerY = lastCenterY + shift;

  // clamp inside borders
  if(centerY < 120) centerY = 120;
  if(centerY > canvas.height-120) centerY = canvas.height-120;

  let top = centerY - gapSize/2;
  let bottom = centerY + gapSize/2;

  segments.push({
    x: spawnX,
    prevTop: lastCenterY - gapSize/2,
    prevBottom: lastCenterY + gapSize/2,
    top: top,
    bottom: bottom
  });

  lastCenterY = centerY;
  spawnX += segmentWidth;

  // flip direction every segment â†’ no skipping
  direction *= -1;
}

for(let i=0;i<40;i++) spawnSegment();

// ---- INPUT ----
function startHold(){ if(gameState==="playing") holding=true; }
function stopHold(){ holding=false; }

document.addEventListener("keydown", e=>{
  if(["Space","KeyW","ArrowUp"].includes(e.code)) startHold();
  if(e.key==="r") location.reload();
});
document.addEventListener("keyup", e=>{
  if(["Space","KeyW","ArrowUp"].includes(e.code)) stopHold();
});
document.addEventListener("mousedown", e=>{ if(e.button===0) startHold(); });
document.addEventListener("mouseup", e=>{ if(e.button===0) stopHold(); });

// ---- UPDATE ----
function update(){

  ctx.fillStyle="black";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  if(gameState==="dead"){
    ctx.fillStyle="white";
    ctx.font="40px Arial";
    ctx.fillText("INSANE - PRESS R", canvas.width/2-180, canvas.height/2);
    requestAnimationFrame(update);
    return;
  }

  score++;

  let speed = baseSpeed;
  let waveSpeed = 9;    // aggressive movement

  if(holding) player.y -= waveSpeed;
  else player.y += waveSpeed;

  // borders
  ctx.fillStyle="red";
  ctx.fillRect(0,0,canvas.width,6);
  ctx.fillRect(0,canvas.height-6,canvas.width,6);

  if(player.y < 6 || player.y + player.size > canvas.height-6){
    gameState = "dead";
  }

  // player
  ctx.fillStyle="cyan";
  ctx.fillRect(player.x, player.y, player.size, player.size);

  for(let s of segments){

    s.x -= speed;

    ctx.strokeStyle="orange";
    ctx.lineWidth=3;

    ctx.beginPath();
    ctx.moveTo(s.x, s.prevTop);
    ctx.lineTo(s.x + segmentWidth, s.top);
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(s.x, s.prevBottom);
    ctx.lineTo(s.x + segmentWidth, s.bottom);
    ctx.stroke();

    if(
      lineCollision(player.x, player.y, player.size,
        s.x, s.prevTop,
        s.x+segmentWidth, s.top
      ) ||
      lineCollision(player.x, player.y, player.size,
        s.x, s.prevBottom,
        s.x+segmentWidth, s.bottom
      )
    ){
      gameState="dead";
    }

    if(s.x < -segmentWidth){
      segments.shift();
      spawnSegment();
    }
  }

  requestAnimationFrame(update);
}

update();
</script>
</body>
</html>
